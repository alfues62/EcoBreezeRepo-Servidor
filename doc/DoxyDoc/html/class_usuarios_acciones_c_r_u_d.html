<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EcoBreeze: UsuariosAccionesCRUD Class Reference</title>
<link rel="icon" href="EcoBreezeLogo.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">EcoBreeze<span id="projectnumber">&#160;v0.3</span>
   </div>
   <div id="projectbrief">EcoBreeze te permite monitorizar la calidad del aire en tu zona!</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_usuarios_acciones_c_r_u_d-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">UsuariosAccionesCRUD Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aa9f2d224c50da3f0f81b6ebb6a8b51fb" id="r_aa9f2d224c50da3f0f81b6ebb6a8b51fb"><td class="memItemLeft" align="right" valign="top"><a id="aa9f2d224c50da3f0f81b6ebb6a8b51fb" name="aa9f2d224c50da3f0f81b6ebb6a8b51fb"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__construct</b> ($conn)</td></tr>
<tr class="separator:aa9f2d224c50da3f0f81b6ebb6a8b51fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acedb8d6511169749b0b08725c344e009" id="r_acedb8d6511169749b0b08725c344e009"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acedb8d6511169749b0b08725c344e009">registrar</a> ($nombre, $apellidos, $email, $contrasenaHash, $token)</td></tr>
<tr class="separator:acedb8d6511169749b0b08725c344e009"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace4cadfbd16187fc61d2f437ee8a9723" id="r_ace4cadfbd16187fc61d2f437ee8a9723"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ace4cadfbd16187fc61d2f437ee8a9723">verificarCorreo</a> ($email, $token)</td></tr>
<tr class="separator:ace4cadfbd16187fc61d2f437ee8a9723"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a716c4e465729d50fc134f5ecfd495dc1" id="r_a716c4e465729d50fc134f5ecfd495dc1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a716c4e465729d50fc134f5ecfd495dc1">insertarSensor</a> ($usuarioID, $mac)</td></tr>
<tr class="separator:a716c4e465729d50fc134f5ecfd495dc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37a2569148d9d5d8bfe39ad269f9281b" id="r_a37a2569148d9d5d8bfe39ad269f9281b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a37a2569148d9d5d8bfe39ad269f9281b">cambiarContrasenaPorID</a> ($id, $contrasenaActual, $nuevaContrasena)</td></tr>
<tr class="separator:a37a2569148d9d5d8bfe39ad269f9281b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cdd0fce92ed3b377e882f8d78762f66" id="r_a1cdd0fce92ed3b377e882f8d78762f66"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1cdd0fce92ed3b377e882f8d78762f66">cambiarTokenPorID</a> ($id, $contrasenaActual, $token)</td></tr>
<tr class="separator:a1cdd0fce92ed3b377e882f8d78762f66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cdda48bdee4d2d338e09bc9bcf2cc44" id="r_a1cdda48bdee4d2d338e09bc9bcf2cc44"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1cdda48bdee4d2d338e09bc9bcf2cc44">cambiarCorreo</a> ($email, $nuevoCorreo)</td></tr>
<tr class="separator:a1cdda48bdee4d2d338e09bc9bcf2cc44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06303f69e35e70bca18644bb82de3670" id="r_a06303f69e35e70bca18644bb82de3670"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a06303f69e35e70bca18644bb82de3670">recuperarContrasena</a> ($email, $token, $nueva_contrasena)</td></tr>
<tr class="separator:a06303f69e35e70bca18644bb82de3670"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34e68b628fad59270cb33fba51d82490" id="r_a34e68b628fad59270cb33fba51d82490"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a34e68b628fad59270cb33fba51d82490">cambiarContrasenaPorCorreo</a> ($email, $nuevaContrasena)</td></tr>
<tr class="separator:a34e68b628fad59270cb33fba51d82490"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98fd005d3a36b08cc03861755d66fea7" id="r_a98fd005d3a36b08cc03861755d66fea7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a98fd005d3a36b08cc03861755d66fea7">actualizarTokenRecuperacion</a> ($email, $token)</td></tr>
<tr class="separator:a98fd005d3a36b08cc03861755d66fea7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a342159e2682f6f6aaaf3eaa614bb052c" id="r_a342159e2682f6f6aaaf3eaa614bb052c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a342159e2682f6f6aaaf3eaa614bb052c">subirTokenHuella</a> ($id, $tokenHuella)</td></tr>
<tr class="separator:a342159e2682f6f6aaaf3eaa614bb052c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46f9c2979fa7aee192b04f72dbec0aab" id="r_a46f9c2979fa7aee192b04f72dbec0aab"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a46f9c2979fa7aee192b04f72dbec0aab">registrarAdmin</a> ($nombre, $apellidos, $email, $contrasenaHash)</td></tr>
<tr class="separator:a46f9c2979fa7aee192b04f72dbec0aab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b811b893bded50c0bbd55f3f2e1f385" id="r_a8b811b893bded50c0bbd55f3f2e1f385"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8b811b893bded50c0bbd55f3f2e1f385">eliminarUsuario</a> ($idUsuario)</td></tr>
<tr class="separator:a8b811b893bded50c0bbd55f3f2e1f385"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a98fd005d3a36b08cc03861755d66fea7" name="a98fd005d3a36b08cc03861755d66fea7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98fd005d3a36b08cc03861755d66fea7">&#9670;&#160;</a></span>actualizarTokenRecuperacion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UsuariosAccionesCRUD::actualizarTokenRecuperacion </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$email</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$token</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Actualiza el token de recuperación para un usuario basado en su correo electrónico.</p>
<p>Este método permite actualizar el token de recuperación de un usuario y su fecha de expiración. Si el usuario está verificado y se encuentra en la base de datos, se genera un nuevo token y se actualiza en la base de datos con una expiración de 2 horas. Si la actualización es exitosa, se devuelve un mensaje de éxito junto con los datos del usuario.</p>
<p>Diseño:</p>
<p>Entrada:</p><ul>
<li>email (string, correo electrónico del usuario para actualizar el token de recuperación).</li>
<li>token (string, el nuevo token de recuperación generado).</li>
</ul>
<p>Proceso:</p><ol type="1">
<li>Consultar al usuario en la base de datos utilizando su correo electrónico.</li>
<li>Si el usuario no existe, se retorna un error indicando que el correo no fue encontrado.</li>
<li>Verificar que el usuario esté verificado.</li>
<li>Si el usuario está verificado, generar una nueva fecha de expiración para el token (2 horas).</li>
<li>Actualizar el token y la expiración en la base de datos.</li>
<li>Verificar si la actualización fue exitosa y registrar la información en el log.</li>
<li>Si la actualización es exitosa, se devuelve un mensaje de éxito con los datos del usuario.</li>
<li>Si ocurre un error en el proceso, se captura la excepción y se registra en el log.</li>
</ol>
<p>Salida:</p><ul>
<li>En caso de éxito: { "success": "Token de recuperación registrado y actualizado con éxito.", "nombre": "Nombre del usuario", "apellidos": "Apellidos del usuario", "email": "Correo electrónico del usuario" }</li>
<li>En caso de error: { "error": "Motivo del error." }</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$email</td><td>El correo electrónico del usuario cuyo token de recuperación se actualizará. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$token</td><td>El nuevo token de recuperación generado. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Un array con un mensaje de éxito o error. </dd></dl>

</div>
</div>
<a id="a34e68b628fad59270cb33fba51d82490" name="a34e68b628fad59270cb33fba51d82490"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34e68b628fad59270cb33fba51d82490">&#9670;&#160;</a></span>cambiarContrasenaPorCorreo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UsuariosAccionesCRUD::cambiarContrasenaPorCorreo </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$email</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$nuevaContrasena</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Cambia la contraseña de un usuario por su correo electrónico.</p>
<p>Este método permite a un usuario cambiar su contraseña utilizando su correo electrónico. Primero, se verifica que el usuario exista en la base de datos y luego se actualiza la contraseña, el token de recuperación y la expiración del token. Si la contraseña no cambia, se notificará que no se realizaron cambios.</p>
<p>Diseño:</p>
<p>Entrada:</p><ul>
<li>email (string, correo electrónico del usuario).</li>
<li>nuevaContrasena (string, nueva contraseña que el usuario desea establecer).</li>
</ul>
<p>Proceso:</p><ol type="1">
<li>Consultar al usuario utilizando su correo electrónico para obtener su ID y el hash de la contraseña.</li>
<li>Si el usuario no existe, se retorna un error indicando que no se encontró al usuario.</li>
<li>Si el usuario existe, se genera un hash de la nueva contraseña.</li>
<li>Se prepara la consulta para actualizar la contraseña del usuario, y se establece el token y la expiración a 0.</li>
<li>Si se actualiza la contraseña correctamente, se retorna un mensaje de éxito.</li>
<li>Si no se realizaron cambios (la contraseña ya es la misma), se retorna un mensaje de error.</li>
<li>En caso de error, se registra el error y se retorna un mensaje indicando que hubo un problema al cambiar la contraseña.</li>
</ol>
<p>Salida:</p><ul>
<li>En caso de éxito: { "success": true, "message": "Contraseña y token actualizados con éxito." }</li>
<li>En caso de error: { "success": false, "error": "Motivo del error." }</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$email</td><td>El correo electrónico del usuario que desea cambiar su contraseña. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$nuevaContrasena</td><td>La nueva contraseña que el usuario desea establecer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Un array con un mensaje de éxito o error. </dd></dl>

</div>
</div>
<a id="a37a2569148d9d5d8bfe39ad269f9281b" name="a37a2569148d9d5d8bfe39ad269f9281b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37a2569148d9d5d8bfe39ad269f9281b">&#9670;&#160;</a></span>cambiarContrasenaPorID()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UsuariosAccionesCRUD::cambiarContrasenaPorID </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$id</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$contrasenaActual</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$nuevaContrasena</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Cambia la contraseña de un usuario por su ID.</p>
<p>Este método permite actualizar la contraseña de un usuario en la base de datos. Se verifica que la contraseña actual ingresada coincida con la almacenada antes de proceder con el cambio.</p>
<p>Diseño:</p>
<p>Entrada:</p><ul>
<li>id (int, ID del usuario cuya contraseña se desea cambiar).</li>
<li>contrasenaActual (string, contraseña actual del usuario para verificar su autenticidad).</li>
<li>nuevaContrasena (string, nueva contraseña que será almacenada tras la verificación).</li>
</ul>
<p>Proceso:</p><ol type="1">
<li>Obtener la contraseña almacenada del usuario por su ID.</li>
<li>Verificar si el usuario existe.</li>
<li>Comparar la contraseña actual ingresada con el hash almacenado.</li>
<li>Si coincide:<ul>
<li>Hashear la nueva contraseña.</li>
<li>Actualizar el hash de la contraseña en la base de datos.</li>
<li>Retornar éxito si se actualizó correctamente.</li>
</ul>
</li>
<li>Si no coincide, retornar un mensaje de error.</li>
<li>Registrar en el log cualquier error ocurrido durante el proceso.</li>
</ol>
<p>Salida:</p><ul>
<li>En caso de éxito: { "success": true, "message": "Contraseña actualizada con éxito." }</li>
<li>En caso de error: { "success": false, "error": "Motivo del error." }</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$id</td><td>El ID del usuario cuya contraseña será actualizada. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$contrasenaActual</td><td>La contraseña actual del usuario para validar. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$nuevaContrasena</td><td>La nueva contraseña que será almacenada. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Un array con un mensaje de éxito o error. </dd></dl>

</div>
</div>
<a id="a1cdda48bdee4d2d338e09bc9bcf2cc44" name="a1cdda48bdee4d2d338e09bc9bcf2cc44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cdda48bdee4d2d338e09bc9bcf2cc44">&#9670;&#160;</a></span>cambiarCorreo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UsuariosAccionesCRUD::cambiarCorreo </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$email</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$nuevoCorreo</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Cambia el correo electrónico de un usuario.</p>
<p>Este método permite actualizar la dirección de correo electrónico de un usuario en la base de datos, también restableciendo el token y su fecha de expiración para garantizar la validez de los datos del usuario.</p>
<p>Diseño:</p>
<p>Entrada:</p><ul>
<li>email (string, correo electrónico actual del usuario que desea cambiar).</li>
<li>nuevoCorreo (string, nuevo correo electrónico que se desea asignar al usuario).</li>
</ul>
<p>Proceso:</p><ol type="1">
<li>Iniciar una transacción para asegurar la integridad de los cambios.</li>
<li>Preparar y ejecutar una consulta SQL para actualizar el correo electrónico del usuario.</li>
<li>Establecer el valor del token y la expiración a 0 para invalidar cualquier token asociado.</li>
<li>Verificar si se actualizó el correo electrónico correctamente.</li>
<li>Si la actualización es exitosa, confirmar la transacción y retornar un mensaje de éxito.</li>
<li>Si no se realizaron cambios, revertir la transacción y retornar un mensaje de error.</li>
<li>Registrar cualquier error ocurrido durante el proceso en un archivo de log.</li>
</ol>
<p>Salida:</p><ul>
<li>En caso de éxito: { "success": true, "message": "Correo electrónico actualizado con éxito." }</li>
<li>En caso de error: { "success": false, "error": "Motivo del error." }</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$email</td><td>El correo electrónico actual del usuario. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$nuevoCorreo</td><td>El nuevo correo electrónico que se desea asignar al usuario. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Un array con un mensaje de éxito o error. </dd></dl>

</div>
</div>
<a id="a1cdd0fce92ed3b377e882f8d78762f66" name="a1cdd0fce92ed3b377e882f8d78762f66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cdd0fce92ed3b377e882f8d78762f66">&#9670;&#160;</a></span>cambiarTokenPorID()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UsuariosAccionesCRUD::cambiarTokenPorID </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$id</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$contrasenaActual</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$token</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Cambia el token de un usuario por su ID.</p>
<p>Este método permite actualizar el token de un usuario en la base de datos tras validar su contraseña actual. También establece una nueva fecha de expiración para el token, configurada a 24 horas a partir del momento de la actualización.</p>
<p>Diseño:</p>
<p>Entrada:</p><ul>
<li>id (int, ID del usuario cuyo token se desea cambiar).</li>
<li>contrasenaActual (string, contraseña actual del usuario para validar su autenticidad).</li>
<li>token (string, nuevo token que será asignado al usuario).</li>
</ul>
<p>Proceso:</p><ol type="1">
<li>Consultar la contraseña almacenada del usuario por su ID.</li>
<li>Verificar si el usuario existe.</li>
<li>Comparar la contraseña actual ingresada con el hash almacenado en la base de datos.</li>
<li>Si coincide:<ul>
<li>Preparar y ejecutar una consulta para actualizar el token y establecer su expiración a 24 horas desde el momento actual.</li>
<li>Verificar si el token fue actualizado correctamente.</li>
<li>Retornar éxito si la operación fue exitosa.</li>
</ul>
</li>
<li>Si no coincide, retornar un mensaje de error indicando que la contraseña es incorrecta.</li>
<li>Registrar cualquier error ocurrido durante el proceso en un archivo de log.</li>
</ol>
<p>Salida:</p><ul>
<li>En caso de éxito: { "success": true, "message": "Token actualizado con éxito." }</li>
<li>En caso de error: { "success": false, "error": "Motivo del error." }</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$id</td><td>El ID del usuario cuyo token será actualizado. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$contrasenaActual</td><td>La contraseña actual del usuario para validar. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$token</td><td>El nuevo token que será asignado al usuario. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Un array con un mensaje de éxito o error. </dd></dl>

</div>
</div>
<a id="a8b811b893bded50c0bbd55f3f2e1f385" name="a8b811b893bded50c0bbd55f3f2e1f385"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b811b893bded50c0bbd55f3f2e1f385">&#9670;&#160;</a></span>eliminarUsuario()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UsuariosAccionesCRUD::eliminarUsuario </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$idUsuario</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Elimina un usuario y su(s) sensor(es) asociado(s) de la base de datos.</p>
<p>Este método permite eliminar un usuario de la tabla <code>USUARIO</code>, y debido a la configuración de la base de datos (ON DELETE CASCADE), los sensores asociados también se eliminarán automáticamente. Si el usuario no se encuentra, o si no se puede eliminar, se registra un error y se retorna un mensaje adecuado.</p>
<p>Diseño:</p>
<p>Entrada:</p><ul>
<li>idUsuario (int, el ID del usuario que se desea eliminar).</li>
</ul>
<p>Proceso:</p><ol type="1">
<li>Se verifica si el usuario existe en la base de datos con el ID proporcionado.</li>
<li>Si el usuario existe, se procede a eliminarlo y a eliminar los sensores asociados de manera automática.</li>
<li>Si la eliminación es exitosa, se retorna un mensaje de éxito.</li>
<li>Si no se puede eliminar el usuario o no se encuentra, se retorna un mensaje de error.</li>
</ol>
<p>Salida:</p><ul>
<li>En caso de éxito: { "success": true, "message": "Usuario y sensor(es) asociados eliminados con éxito." }</li>
<li>En caso de error: { "success": false, "error": "No se pudo eliminar el usuario." } o { "success": false, "error": "No se encontró el usuario con ese ID." }</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$idUsuario</td><td>El ID del usuario que se desea eliminar. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Un array con un mensaje de éxito o error. </dd></dl>

</div>
</div>
<a id="a716c4e465729d50fc134f5ecfd495dc1" name="a716c4e465729d50fc134f5ecfd495dc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a716c4e465729d50fc134f5ecfd495dc1">&#9670;&#160;</a></span>insertarSensor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UsuariosAccionesCRUD::insertarSensor </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$usuarioID</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$mac</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Inserta un nuevo sensor en la base de datos.</p>
<p>Este método permite registrar un sensor asociado a un usuario en la base de datos utilizando su ID y la dirección MAC del sensor. En caso de éxito, devuelve un mensaje confirmando la operación; si ocurre un error, registra el detalle en el log y devuelve un mensaje de error.</p>
<p>Diseño:</p>
<p>Entrada:</p><ul>
<li>usuarioID (int, ID del usuario al que se asociará el sensor)</li>
<li>mac (string, dirección MAC del sensor)</li>
</ul>
<p>Proceso:</p><ol type="1">
<li>Preparar la consulta SQL para insertar el sensor.</li>
<li>Ejecutar la consulta con los parámetros proporcionados.</li>
<li>Retornar éxito si la inserción es exitosa.</li>
<li>En caso de error, registrar el mensaje de error en el log y devolver un mensaje de error al cliente.</li>
</ol>
<p>Salida:</p><ul>
<li>En caso de éxito: { "success": "Sensor insertado con éxito." }</li>
<li>En caso de error: { "error": "Error al insertar el sensor." }</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$usuarioID</td><td>El ID del usuario al que se asociará el sensor. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$mac</td><td>La dirección MAC del sensor. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Un array con un mensaje de éxito o error. </dd></dl>

</div>
</div>
<a id="a06303f69e35e70bca18644bb82de3670" name="a06303f69e35e70bca18644bb82de3670"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06303f69e35e70bca18644bb82de3670">&#9670;&#160;</a></span>recuperarContrasena()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UsuariosAccionesCRUD::recuperarContrasena </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$email</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$token</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$nueva_contrasena</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Recupera la contraseña de un usuario a través de un token de recuperación.</p>
<p>Este método permite a un usuario recuperar su contraseña utilizando un token de recuperación enviado previamente. El token se valida y, si es válido y no ha expirado, se actualiza la contraseña con la nueva proporcionada por el usuario. Además, se limpia el token y su fecha de expiración para garantizar la seguridad.</p>
<p>Diseño:</p>
<p>Entrada:</p><ul>
<li>email (string, correo electrónico del usuario para recuperar la contraseña).</li>
<li>token (string, token de recuperación asociado al usuario).</li>
<li>nueva_contrasena (string, nueva contraseña que el usuario desea establecer).</li>
</ul>
<p>Proceso:</p><ol type="1">
<li>Iniciar una transacción para asegurar que todas las operaciones se realicen de manera atómica.</li>
<li>Consultar al usuario por su correo y verificar si existe.</li>
<li>Si el usuario no existe, se retorna un error.</li>
<li>Verificar si el token ha expirado comparando la fecha actual con la fecha de expiración del token.<ul>
<li>Si el token ha expirado, se restablecen los valores del token y la fecha de expiración, y se notifica al usuario.</li>
</ul>
</li>
<li>Validar si el token proporcionado coincide con el almacenado.</li>
<li>Si el token es válido, proceder a hashear la nueva contraseña y actualizarla en la base de datos.</li>
<li>Si la actualización de la contraseña es exitosa, se confirma la transacción y se retorna un mensaje de éxito.</li>
<li>Si la actualización no se realizó correctamente, se revierte la transacción y se retorna un mensaje de error.</li>
<li>En caso de error durante el proceso, se revierte la transacción y se registra el error.</li>
</ol>
<p>Salida:</p><ul>
<li>En caso de éxito: { "success": "Contraseña actualizada con éxito." }</li>
<li>En caso de error: { "error": "Motivo del error." }</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$email</td><td>El correo electrónico del usuario que desea recuperar su contraseña. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$token</td><td>El token de recuperación asociado al usuario. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$nueva_contrasena</td><td>La nueva contraseña que el usuario desea establecer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Un array con un mensaje de éxito o error. </dd></dl>

</div>
</div>
<a id="acedb8d6511169749b0b08725c344e009" name="acedb8d6511169749b0b08725c344e009"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acedb8d6511169749b0b08725c344e009">&#9670;&#160;</a></span>registrar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UsuariosAccionesCRUD::registrar </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$nombre</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$apellidos</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$email</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$contrasenaHash</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$token</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Registra un nuevo usuario en la base de datos.</p>
<p>Este método permite insertar un usuario con los datos proporcionados, estableciendo el rol predeterminado y configurando un token de verificación con una expiración de 24 horas. Antes de la inserción, verifica si el correo electrónico ya está registrado. Si el registro existe pero el token ha expirado, se elimina el usuario y se procede con un nuevo registro. En caso de éxito, se solicita al usuario verificar su correo.</p>
<p>Diseño:</p>
<p>Entrada:</p><ul>
<li>nombre (String)</li>
<li>apellidos (String)</li>
<li>email (String, único)</li>
<li>contrasenaHash (String, contraseña ya cifrada)</li>
<li>token (String, generado para la verificación)</li>
</ul>
<p>Proceso:</p><ol type="1">
<li>Verificar si el correo ya está registrado:<ul>
<li>Si el token ha expirado, eliminar el registro previo.</li>
<li>Si no ha expirado: a. Si el usuario está verificado, devolver un mensaje de error. b. Si no está verificado, devolver un mensaje de registro pendiente.</li>
</ul>
</li>
<li>Insertar el usuario con los campos proporcionados y valores predeterminados.</li>
</ol>
<p>Salida:</p><ul>
<li>En caso de éxito: { "success": "Usuario insertado con éxito. Por favor verifica tu correo." }</li>
<li>En caso de error: { "error": "Mensaje descriptivo del error." }</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$nombre</td><td>El nombre del usuario. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$apellidos</td><td>Los apellidos del usuario. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$email</td><td>El correo electrónico del usuario. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$contrasenaHash</td><td>La contraseña cifrada del usuario. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$token</td><td>El token generado para la verificación. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Un array con un mensaje de éxito o error. </dd></dl>

</div>
</div>
<a id="a46f9c2979fa7aee192b04f72dbec0aab" name="a46f9c2979fa7aee192b04f72dbec0aab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46f9c2979fa7aee192b04f72dbec0aab">&#9670;&#160;</a></span>registrarAdmin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UsuariosAccionesCRUD::registrarAdmin </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$nombre</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$apellidos</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$email</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$contrasenaHash</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Registra un nuevo administrador en el sistema.</p>
<p>Este método permite registrar un nuevo usuario con rol de administrador en la base de datos. Se le asigna el rol de administrador automáticamente (ROL_RolID = 1) y se garantiza que el campo de verificación está marcado como '1' (verificado).</p>
<p>Diseño:</p>
<p>Entrada:</p><ul>
<li>nombre (string, el nombre del administrador).</li>
<li>apellidos (string, los apellidos del administrador).</li>
<li>email (string, el correo electrónico del administrador).</li>
<li>contrasenaHash (string, la contraseña del administrador, ya hasheada).</li>
</ul>
<p>Proceso:</p><ol type="1">
<li>Se prepara la consulta para insertar los datos del administrador en la tabla <code>USUARIO</code>.</li>
<li>Los campos <code>token</code>, <code>expiracion_token</code> y <code>token_huella</code> se dejan como <code>NULL</code> por defecto.</li>
<li>Se asigna el valor de <code>ROL_RolID</code> como <code>1</code>, indicando que el usuario es un administrador.</li>
<li>Si la inserción es exitosa, se retorna un mensaje de éxito.</li>
<li>Si ocurre un error en el proceso, se captura la excepción y se registra en el log.</li>
</ol>
<p>Salida:</p><ul>
<li>En caso de éxito: { "success": "Administrador añadido con éxito." }</li>
<li>En caso de error: { "error": "Error al insertar un administrador." }</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$nombre</td><td>El nombre del administrador. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$apellidos</td><td>Los apellidos del administrador. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$email</td><td>El correo electrónico del administrador. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$contrasenaHash</td><td>La contraseña hasheada del administrador. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Un array con un mensaje de éxito o error. </dd></dl>

</div>
</div>
<a id="a342159e2682f6f6aaaf3eaa614bb052c" name="a342159e2682f6f6aaaf3eaa614bb052c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a342159e2682f6f6aaaf3eaa614bb052c">&#9670;&#160;</a></span>subirTokenHuella()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UsuariosAccionesCRUD::subirTokenHuella </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$id</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$tokenHuella</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Actualiza el token de huella para un usuario basado en su ID.</p>
<p>Este método permite subir el token de huella para un usuario, utilizando su ID. Si el usuario existe, se actualiza el token de huella en la base de datos.</p>
<p>Diseño:</p>
<p>Entrada:</p><ul>
<li>id (int, el ID del usuario para actualizar el token de huella).</li>
<li>tokenHuella (string, el nuevo token de huella que se va a asignar al usuario).</li>
</ul>
<p>Proceso:</p><ol type="1">
<li>Consultar al usuario en la base de datos utilizando su ID.</li>
<li>Si el usuario no existe, se retorna un error indicando que no se encontró el usuario.</li>
<li>Si el usuario existe, se actualiza el token de huella con el valor proporcionado.</li>
<li>Verificar si la actualización fue exitosa y retornar un mensaje de éxito o error según corresponda.</li>
<li>Si ocurre un error en el proceso, se captura la excepción y se registra en el log.</li>
</ol>
<p>Salida:</p><ul>
<li>En caso de éxito: { "success": true, "message": "Token de huella actualizado con éxito." }</li>
<li>En caso de error: { "success": false, "error": "Motivo del error." }</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">int</td><td class="paramname">$id</td><td>El ID del usuario cuyo token de huella se actualizará. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$tokenHuella</td><td>El nuevo token de huella generado. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Un array con un mensaje de éxito o error. </dd></dl>

</div>
</div>
<a id="ace4cadfbd16187fc61d2f437ee8a9723" name="ace4cadfbd16187fc61d2f437ee8a9723"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace4cadfbd16187fc61d2f437ee8a9723">&#9670;&#160;</a></span>verificarCorreo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UsuariosAccionesCRUD::verificarCorreo </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$email</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>$token</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Verifica la dirección de correo electrónico de un usuario.</p>
<p>Este método permite validar un correo electrónico utilizando un token de verificación. Si el token es válido y no ha expirado, el usuario es marcado como verificado. Si el token ha expirado o es inválido, se devuelve un mensaje descriptivo y se elimina al usuario si corresponde.</p>
<p>Diseño:</p>
<p>Entrada:</p><ul>
<li>email (String, correo electrónico del usuario)</li>
<li>token (String, token de verificación)</li>
</ul>
<p>Proceso:</p><ol type="1">
<li>Consultar al usuario en la base de datos utilizando el correo.<ul>
<li>Si no existe, retornar error: "Correo no encontrado."</li>
</ul>
</li>
<li>Verificar si ya está marcado como verificado:<ul>
<li>Si está verificado, retornar éxito: "El correo ya estaba verificado."</li>
</ul>
</li>
<li>Comparar la fecha de expiración del token con la fecha actual:<ul>
<li>Si el token ha expirado, eliminar al usuario y retornar error: "El token ha expirado."</li>
</ul>
</li>
<li>Validar el token:<ul>
<li>Si no coincide, retornar error: "Token no válido."</li>
</ul>
</li>
<li>Si las validaciones pasan, marcar al usuario como verificado:<ul>
<li>Actualizar el estado a verificado y borrar el token.</li>
<li>Retornar éxito: "Correo verificado con éxito."</li>
</ul>
</li>
</ol>
<p>Salida:</p><ul>
<li>En caso de éxito: { "success": "Correo verificado con éxito." }</li>
<li>En caso de error: { "error": "Mensaje descriptivo del error." }</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$email</td><td>El correo electrónico a verificar. </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$token</td><td>El token de verificación asociado al correo. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array Un array con un mensaje de éxito o error. </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>C:/GTI_Carpeta/BiometriaRepos/EcoBreezeRepo-Servidor/src/EcoBreeze/backend/controllers/<b>usuario_acciones_CRUD.php</b></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
